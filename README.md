# AstrBot Prompt Injector Plugin

这是一个 AstrBot 插件，允许用户为当前会话注入自定义的提示词（Prompt），包括“当前任务”和“附加知识”。这些注入的内容会自动添加到 LLM 的 System Prompt 中，并在指定轮次的对话内生效。

适用于需要让 AI 暂时扮演特定角色（如跑团主持人）、处理特定任务或基于特定背景知识进行对话的场景。

## 🌟 功能特性

*   **会话隔离**：每个群聊或私聊会话拥有独立的注入内容，互不干扰。
*   **两种注入类型**：
    *   `当前任务`：注入 AI 目前正在处理的任务描述。
    *   `附加知识`：注入 AI 需要参考的背景知识。
*   **轮次控制**：可以配置注入内容生效的对话轮次（默认为 10 轮），轮次耗尽后自动清除，避免污染后续对话。
*   **白名单模式**：支持开启白名单模式，仅允许特定会话使用注入功能，防止滥用。

## ⚙️ 配置说明

在 AstrBot 管理面板的插件配置中，你可以设置以下选项：

| 配置项 | 类型 | 默认值 | 说明 |
| :--- | :--- | :--- | :--- |
| `max_turns` | 整数 | `10` | 注入内容默认生效的对话轮次。 |
| `whitelist_mode` | 布尔值 | `false` | 是否开启白名单模式。开启后，只有白名单内的会话可用。 |
| `whitelist` | 列表 | `[]` | 允许使用功能的会话 ID (`unified_msg_origin`) 列表。 |

## 💻 指令介绍

| 指令 | 参数 | 说明 |
| :--- | :--- | :--- |
| `/set_task` | `<任务描述>` | 设置当前会话的“当前任务”提示词。重置剩余轮次。 |
| `/set_know` | `<知识内容>` | 设置当前会话的“附加知识”提示词。重置剩余轮次。 |
| `/show_injections` | 无 | 查看当前会话生效的注入内容及剩余轮次。 |
| `/clear_injections` | 无 | 清除当前会话的所有注入内容。 |
| `/add_whitelist` | 无 | **(仅管理员)** 将当前会话加入白名单。 |

### 使用示例

**场景：让 AI 扮演跑团主持人**

1.  **注入任务**：
    ```
    /set_task 你现在是一个跑团主持人，你需要根据我给出的剧情发展来写接下来的剧情。风格要克苏鲁一点。
    ```
    *AI 回复：✅ 当前任务已注入，将在接下来的 10 轮对话中生效。*

2.  **注入背景知识（可选）**：
    ```
    /set_know 现在的地点是在一所废弃的阿卡姆疯人院，时间是1920年。
    ```
    *AI 回复：✅ 附加知识已注入，将在接下来的 10 轮对话中生效。*

3.  **开始对话**：
    用户：我推开大门走了进去。
    AI：（基于注入的提示词生成剧情...）

4.  **查看状态**：
    ```
    /show_injections
    ```
    
5.  **结束扮演**：
    ```
    /clear_injections
    ```
